#Key Levels Chart Indicator
#Author: TradeArcher2020
#Version: 0.1
#Date Created: 10/18/2020

AddVerticalLine(SecondsFromTime(1030) == 0 and SecondsTillTime(1030) == 0, text = "Begin Zombie Hours", color = Color.WHITE, stroke = Curve.FIRM);
Alert(SecondsFromTime(1030) == 0 and SecondsTillTime(1030) == 0, "ZOMBIE HOURS", sound = Sound.Chimes);

AddVerticalLine(SecondsFromTime(1500) == 0 and SecondsTillTime(1500) == 0, text = "Begin Reversal Hour", color = Color.WHITE, stroke = Curve.FIRM);
Alert(SecondsFromTime(1500) == 0 and SecondsTillTime(1500) == 0, "REVERSAL HOUR", sound = Sound.Chimes);

DefineGlobalColor("ZombieHours", Color.LIGHT_GRAY);
plot upper = if(SecondsFromTime(1030) >= 0 and SecondsTillTime(1500) >= 0, Double.POSITIVE_INFINITY, Double.NaN);
plot lower = if(SecondsFromTime(1030) >= 0 and SecondsTillTime(1500) >= 0, Double.NEGATIVE_INFINITY, Double.NaN);
AddCloud(upper, lower, color1 = GlobalColor("ZombieHours"), color2 = GlobalColor("ZombieHours"));

#AddVerticalLine(SecondsFromTime(1600) == 0 and SecondsTillTime(1600) == 0, text = "End Reversal Hour", color = Color.WHITE, stroke = Curve.FIRM);
#End Time Specific Lines

#Begin Previous Day's Close
plot previousDaysClose = close(period=”DAY”)[1];
previousDaysClose.SetDefaultColor(color = Color.LIGHT_GRAY);
previousDaysClose.SetStyle(Curve.LONG_DASH);
#End Previous Day's Close

#Begin Previous Day's Open
plot previousDaysOpen = open(period=”DAY”)[1];
previousDaysOpen.SetDefaultColor(color = Color.LIGHT_GRAY);
previousDaysOpen.SetStyle(Curve.LONG_DASH);
#End Previous Day's Close

#Begin Previous Day's High
plot previousDaysHigh = high(period=”DAY”)[1];
previousDaysHigh.SetDefaultColor(color = Color.LIGHT_GRAY);
previousDaysHigh.SetStyle(Curve.LONG_DASH);
#End Previous Day's Close

#Begin Previous Day's Low
plot previousDaysLow = low(period=”DAY”)[1];
previousDaysLow.SetDefaultColor(color = Color.LIGHT_GRAY);
previousDaysLow.SetStyle(Curve.LONG_DASH);
#End Previous Day's Close

#Begin Today's Open
def todaysOpen = open(period = AggregationPeriod.DAY);
plot dailyOpen = todaysOpen;
dailyOpen.AssignValueColor(if close < dailyOpen then Color.DOWNTICK else Color.UPTICK);
dailyOpen.SetStyle(Curve.LONG_DASH);
#End Today's Open

#Begin Today's Close
def beforeStart = GetTime() < RegularTradingStart(GetYYYYMMDD());
def afterEnd = GetTime() > RegularTradingEnd(GetYYYYMMDD());
#def lastSessionEndTime = RegularTradingEnd(GetYYYYMMDD());
#def minutesSinceClose = SecondsFromTime(0400) / 60;

def isAfterHours = !beforeStart and afterEnd;
#def isPreMarket = beforeStart and !afterEnd;
def isMarketHours = !beforeStart and !afterEnd;

plot todaysClose = if isMarketHours then close(period = AggregationPeriod.DAY, priceType = PriceType.LAST) else if isAfterHours then close(period = AggregationPeriod.DAY, priceType = PriceType.LAST)[0] else close(period = AggregationPeriod.DAY, priceType = PriceType.LAST)[1];

todaysClose.SetDefaultColor(color = Color.LIGHT_GRAY);
todaysClose.SetStyle(Curve.SHORT_DASH);
#End Today's Close

#Begin Pre-Market High
def h = high;
def bar = BarNumber();
def isOutsideTradingHours = GetTime() < RegularTradingStart(GetYYYYMMDD());
def overNightHigh = if isOutsideTradingHours and !isOutsideTradingHours[1] then h else if isOutsideTradingHours and h > overNightHigh[1] then h else overNightHigh[1];
def overNightHighBar = if isOutsideTradingHours and h == overNightHigh then bar else Double.NaN;
def overNightHighest = if BarNumber() == HighestAll(overNightHighBar) then overNightHigh else overNightHighest[1];

plot overNightHighestLine = overNightHighest;
overNightHighestLine.SetDefaultColor(color = Color.LIGHT_GRAY);
overNightHighestLine.SetStyle(Curve.SHORT_DASH);
#End Pre-MarketForecast High

#Begin Pre-Market Low
def l = low;
def overNightLow = if isOutsideTradingHours and !isOutsideTradingHours[1] then l else if isOutsideTradingHours and l < overNightLow[1] then l else overNightLow[1];
def overNightLowBar = if isOutsideTradingHours and l == overNightLow then bar else Double.NaN;
def overNightLowest = if BarNumber() == HighestAll(overNightLowBar) then overNightLow else overNightLowest[1];

plot overNightLowestLine = overNightLowest;
overNightLowestLine.SetDefaultColor(color = Color.LIGHT_GRAY);
overNightLowestLine.SetStyle(Curve.SHORT_DASH);
#End Pre-MarketForecast Low

#Begin After-Market High
#End After-Market High

#Begin High Of Day
plot highOfDay = high(period = AggregationPeriod.DAY);
highOfDay.SetDefaultColor(color = Color.LIGHT_GRAY);
highOfDay.SetStyle(Curve.SHORT_DASH);
#End High of Day

#Begin Low Of Day
plot lowOfDay = low(period = AggregationPeriod.DAY);
lowOfDay.SetDefaultColor(color = Color.LIGHT_GRAY);
lowOfDay.SetStyle(Curve.SHORT_DASH);
#End High of Day

#Begin Year High
plot yearlyHigh = Highest(high(period = AggregationPeriod.DAY), length = 365);
yearlyHigh.SetDefaultColor(color = Color.LIGHT_GRAY);
yearlyHigh.SetStyle(Curve.SHORT_DASH);
#End Year High

#Begin Year Low
plot yearlyLow = Lowest(low(period = AggregationPeriod.DAY), length = 365);
yearlyLow.SetDefaultColor(color = Color.LIGHT_GRAY);
yearlyLow.SetStyle(Curve.SHORT_DASH);
#End Year Low

#Begin Fifteen Minute Highs
plot fifteenMinHigh = Highest(high(period = AggregationPeriod.FIFTEEN_MIN), length = 1);
fifteenMinHigh.SetDefaultColor(color = Color.LIGHT_GRAY);
fifteenMinHigh.SetStyle(Curve.SHORT_DASH);
fifteenMinHigh.SetPaintingStrategy(paintingStrategy = PaintingStrategy.HORIZONTAL);
#End Fifteen Minute High

#Begin Fifteen Minute Low
plot fifteenMinLow = Lowest(low(period = AggregationPeriod.FIFTEEN_MIN), length = 1);
fifteenMinLow.SetDefaultColor(color = Color.LIGHT_GRAY);
fifteenMinLow.SetStyle(Curve.SHORT_DASH);
fifteenMinLow.SetPaintingStrategy(paintingStrategy = PaintingStrategy.HORIZONTAL);
#End Fifteen Minute Low

#Begin ATR
def AvgTrueRng = MovingAverage(AverageType.WILDERS, TrueRange(high(period = ”DAY”)[1], close(period = ”DAY”)[1], low(period = ”DAY”)[1]), 14);
AddLabel(yes, "ATR: " + AvgTrueRng, color = Color.WHITE);
def DailyClose = close(period = ”DAY”)[1];

plot HighATR = DailyClose + AvgTrueRng;
HighATR.SetDefaultColor(color = Color.RED);
HighATR.SetStyle(Curve.SHORT_DASH);

plot LowATR = DailyClose - AvgTrueRng;
LowATR.SetDefaultColor(color = Color.GREEN);
LowATR.SetStyle(Curve.SHORT_DASH);
#End ATR

#Begin 52 Week H/L
plot FiftyTwoWeekHigh = Highest(high(period = AggregationPeriod.DAY),252);
FiftyTwoWeekHigh.SetDefaultColor(color = Color.RED);
FiftyTwoWeekHigh.SetStyle(Curve.SHORT_DASH);

plot FiftyTwoWeekLow = Lowest(low(period = AggregationPeriod.DAY),252);
FiftyTwoWeekLow.SetDefaultColor(color = Color.GREEN);
FiftyTwoWeekLow.SetStyle(Curve.SHORT_DASH);

AddLabel(yes, "52Wk H/L = " + FiftyTwoWeekHigh + " / " + FiftyTwoWeekLow, Color.WHITE);
#End 52 Week H/L
